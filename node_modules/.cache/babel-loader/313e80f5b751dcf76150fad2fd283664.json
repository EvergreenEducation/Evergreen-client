{"ast":null,"code":"'use strict';\n\nvar _class, _temp;\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nvar AuthError = require('./AuthError');\n\nvar fetchWithNetworkError = require('@uppy/utils/lib/fetchWithNetworkError'); // Remove the trailing slash so we can always safely append /xyz.\n\n\nfunction stripSlash(url) {\n  return url.replace(/\\/$/, '');\n}\n\nmodule.exports = (_temp = _class = /*#__PURE__*/function () {\n  function RequestClient(uppy, opts) {\n    this.uppy = uppy;\n    this.opts = opts;\n    this.onReceiveResponse = this.onReceiveResponse.bind(this);\n    this.allowedHeaders = ['accept', 'content-type', 'uppy-auth-token'];\n    this.preflightDone = false;\n  }\n\n  var _proto = RequestClient.prototype;\n\n  _proto.headers = function headers() {\n    var userHeaders = this.opts.companionHeaders || this.opts.serverHeaders || {};\n    return Promise.resolve(_extends({}, this.defaultHeaders, userHeaders));\n  };\n\n  _proto._getPostResponseFunc = function _getPostResponseFunc(skip) {\n    var _this = this;\n\n    return function (response) {\n      if (!skip) {\n        return _this.onReceiveResponse(response);\n      }\n\n      return response;\n    };\n  };\n\n  _proto.onReceiveResponse = function onReceiveResponse(response) {\n    var state = this.uppy.getState();\n    var companion = state.companion || {};\n    var host = this.opts.companionUrl;\n    var headers = response.headers; // Store the self-identified domain name for the Companion instance we just hit.\n\n    if (headers.has('i-am') && headers.get('i-am') !== companion[host]) {\n      var _extends2;\n\n      this.uppy.setState({\n        companion: _extends({}, companion, (_extends2 = {}, _extends2[host] = headers.get('i-am'), _extends2))\n      });\n    }\n\n    return response;\n  };\n\n  _proto._getUrl = function _getUrl(url) {\n    if (/^(https?:|)\\/\\//.test(url)) {\n      return url;\n    }\n\n    return this.hostname + \"/\" + url;\n  };\n\n  _proto._json = function _json(res) {\n    if (res.status === 401) {\n      throw new AuthError();\n    }\n\n    if (res.status < 200 || res.status > 300) {\n      var errMsg = \"Failed request with status: \" + res.status + \". \" + res.statusText;\n      return res.json().then(function (errData) {\n        errMsg = errData.message ? errMsg + \" message: \" + errData.message : errMsg;\n        errMsg = errData.requestId ? errMsg + \" request-Id: \" + errData.requestId : errMsg;\n        throw new Error(errMsg);\n      }).catch(function () {\n        throw new Error(errMsg);\n      });\n    }\n\n    return res.json();\n  };\n\n  _proto.preflight = function preflight(path) {\n    var _this2 = this;\n\n    if (this.preflightDone) {\n      return Promise.resolve(this.allowedHeaders.slice());\n    }\n\n    return fetch(this._getUrl(path), {\n      method: 'OPTIONS'\n    }).then(function (response) {\n      if (response.headers.has('access-control-allow-headers')) {\n        _this2.allowedHeaders = response.headers.get('access-control-allow-headers').split(',').map(function (headerName) {\n          return headerName.trim().toLowerCase();\n        });\n      }\n\n      _this2.preflightDone = true;\n      return _this2.allowedHeaders.slice();\n    }).catch(function (err) {\n      _this2.uppy.log(\"[CompanionClient] unable to make preflight request \" + err, 'warning');\n\n      _this2.preflightDone = true;\n      return _this2.allowedHeaders.slice();\n    });\n  };\n\n  _proto.preflightAndHeaders = function preflightAndHeaders(path) {\n    var _this3 = this;\n\n    return Promise.all([this.preflight(path), this.headers()]).then(function (_ref) {\n      var allowedHeaders = _ref[0],\n          headers = _ref[1]; // filter to keep only allowed Headers\n\n      Object.keys(headers).forEach(function (header) {\n        if (allowedHeaders.indexOf(header.toLowerCase()) === -1) {\n          _this3.uppy.log(\"[CompanionClient] excluding unallowed header \" + header);\n\n          delete headers[header];\n        }\n      });\n      return headers;\n    });\n  };\n\n  _proto.get = function get(path, skipPostResponse) {\n    var _this4 = this;\n\n    return this.preflightAndHeaders(path).then(function (headers) {\n      return fetchWithNetworkError(_this4._getUrl(path), {\n        method: 'get',\n        headers: headers,\n        credentials: 'same-origin'\n      });\n    }).then(this._getPostResponseFunc(skipPostResponse)).then(function (res) {\n      return _this4._json(res);\n    }).catch(function (err) {\n      err = err.isAuthError ? err : new Error(\"Could not get \" + _this4._getUrl(path) + \". \" + err);\n      return Promise.reject(err);\n    });\n  };\n\n  _proto.post = function post(path, data, skipPostResponse) {\n    var _this5 = this;\n\n    return this.preflightAndHeaders(path).then(function (headers) {\n      return fetchWithNetworkError(_this5._getUrl(path), {\n        method: 'post',\n        headers: headers,\n        credentials: 'same-origin',\n        body: JSON.stringify(data)\n      });\n    }).then(this._getPostResponseFunc(skipPostResponse)).then(function (res) {\n      return _this5._json(res);\n    }).catch(function (err) {\n      err = err.isAuthError ? err : new Error(\"Could not post \" + _this5._getUrl(path) + \". \" + err);\n      return Promise.reject(err);\n    });\n  };\n\n  _proto.delete = function _delete(path, data, skipPostResponse) {\n    var _this6 = this;\n\n    return this.preflightAndHeaders(path).then(function (headers) {\n      return fetchWithNetworkError(_this6.hostname + \"/\" + path, {\n        method: 'delete',\n        headers: headers,\n        credentials: 'same-origin',\n        body: data ? JSON.stringify(data) : null\n      });\n    }).then(this._getPostResponseFunc(skipPostResponse)).then(function (res) {\n      return _this6._json(res);\n    }).catch(function (err) {\n      err = err.isAuthError ? err : new Error(\"Could not delete \" + _this6._getUrl(path) + \". \" + err);\n      return Promise.reject(err);\n    });\n  };\n\n  _createClass(RequestClient, [{\n    key: \"hostname\",\n    get: function get() {\n      var _this$uppy$getState = this.uppy.getState(),\n          companion = _this$uppy$getState.companion;\n\n      var host = this.opts.companionUrl;\n      return stripSlash(companion && companion[host] ? companion[host] : host);\n    }\n  }, {\n    key: \"defaultHeaders\",\n    get: function get() {\n      return {\n        Accept: 'application/json',\n        'Content-Type': 'application/json',\n        'Uppy-Versions': \"@uppy/companion-client=\" + RequestClient.VERSION\n      };\n    }\n  }]);\n\n  return RequestClient;\n}(), _class.VERSION = \"1.5.3\", _temp);","map":{"version":3,"sources":["/home/devnineteen/Desktop/Projects/Evergreen-client/node_modules/@uppy/companion-client/lib/RequestClient.js"],"names":["_class","_temp","_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","_defineProperties","props","descriptor","enumerable","configurable","writable","defineProperty","_createClass","Constructor","protoProps","staticProps","AuthError","require","fetchWithNetworkError","stripSlash","url","replace","module","exports","RequestClient","uppy","opts","onReceiveResponse","bind","allowedHeaders","preflightDone","_proto","headers","userHeaders","companionHeaders","serverHeaders","Promise","resolve","defaultHeaders","_getPostResponseFunc","skip","_this","response","state","getState","companion","host","companionUrl","has","get","_extends2","setState","_getUrl","test","hostname","_json","res","status","errMsg","statusText","json","then","errData","message","requestId","Error","catch","preflight","path","_this2","slice","fetch","method","split","map","headerName","trim","toLowerCase","err","log","preflightAndHeaders","_this3","all","_ref","keys","forEach","header","indexOf","skipPostResponse","_this4","credentials","isAuthError","reject","post","data","_this5","body","JSON","stringify","delete","_delete","_this6","_this$uppy$getState","Accept","VERSION"],"mappings":"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","sourcesContent":["'use strict';\n\nvar _class, _temp;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nvar AuthError = require('./AuthError');\n\nvar fetchWithNetworkError = require('@uppy/utils/lib/fetchWithNetworkError'); // Remove the trailing slash so we can always safely append /xyz.\n\n\nfunction stripSlash(url) {\n  return url.replace(/\\/$/, '');\n}\n\nmodule.exports = (_temp = _class = /*#__PURE__*/function () {\n  function RequestClient(uppy, opts) {\n    this.uppy = uppy;\n    this.opts = opts;\n    this.onReceiveResponse = this.onReceiveResponse.bind(this);\n    this.allowedHeaders = ['accept', 'content-type', 'uppy-auth-token'];\n    this.preflightDone = false;\n  }\n\n  var _proto = RequestClient.prototype;\n\n  _proto.headers = function headers() {\n    var userHeaders = this.opts.companionHeaders || this.opts.serverHeaders || {};\n    return Promise.resolve(_extends({}, this.defaultHeaders, userHeaders));\n  };\n\n  _proto._getPostResponseFunc = function _getPostResponseFunc(skip) {\n    var _this = this;\n\n    return function (response) {\n      if (!skip) {\n        return _this.onReceiveResponse(response);\n      }\n\n      return response;\n    };\n  };\n\n  _proto.onReceiveResponse = function onReceiveResponse(response) {\n    var state = this.uppy.getState();\n    var companion = state.companion || {};\n    var host = this.opts.companionUrl;\n    var headers = response.headers; // Store the self-identified domain name for the Companion instance we just hit.\n\n    if (headers.has('i-am') && headers.get('i-am') !== companion[host]) {\n      var _extends2;\n\n      this.uppy.setState({\n        companion: _extends({}, companion, (_extends2 = {}, _extends2[host] = headers.get('i-am'), _extends2))\n      });\n    }\n\n    return response;\n  };\n\n  _proto._getUrl = function _getUrl(url) {\n    if (/^(https?:|)\\/\\//.test(url)) {\n      return url;\n    }\n\n    return this.hostname + \"/\" + url;\n  };\n\n  _proto._json = function _json(res) {\n    if (res.status === 401) {\n      throw new AuthError();\n    }\n\n    if (res.status < 200 || res.status > 300) {\n      var errMsg = \"Failed request with status: \" + res.status + \". \" + res.statusText;\n      return res.json().then(function (errData) {\n        errMsg = errData.message ? errMsg + \" message: \" + errData.message : errMsg;\n        errMsg = errData.requestId ? errMsg + \" request-Id: \" + errData.requestId : errMsg;\n        throw new Error(errMsg);\n      }).catch(function () {\n        throw new Error(errMsg);\n      });\n    }\n\n    return res.json();\n  };\n\n  _proto.preflight = function preflight(path) {\n    var _this2 = this;\n\n    if (this.preflightDone) {\n      return Promise.resolve(this.allowedHeaders.slice());\n    }\n\n    return fetch(this._getUrl(path), {\n      method: 'OPTIONS'\n    }).then(function (response) {\n      if (response.headers.has('access-control-allow-headers')) {\n        _this2.allowedHeaders = response.headers.get('access-control-allow-headers').split(',').map(function (headerName) {\n          return headerName.trim().toLowerCase();\n        });\n      }\n\n      _this2.preflightDone = true;\n      return _this2.allowedHeaders.slice();\n    }).catch(function (err) {\n      _this2.uppy.log(\"[CompanionClient] unable to make preflight request \" + err, 'warning');\n\n      _this2.preflightDone = true;\n      return _this2.allowedHeaders.slice();\n    });\n  };\n\n  _proto.preflightAndHeaders = function preflightAndHeaders(path) {\n    var _this3 = this;\n\n    return Promise.all([this.preflight(path), this.headers()]).then(function (_ref) {\n      var allowedHeaders = _ref[0],\n          headers = _ref[1];\n      // filter to keep only allowed Headers\n      Object.keys(headers).forEach(function (header) {\n        if (allowedHeaders.indexOf(header.toLowerCase()) === -1) {\n          _this3.uppy.log(\"[CompanionClient] excluding unallowed header \" + header);\n\n          delete headers[header];\n        }\n      });\n      return headers;\n    });\n  };\n\n  _proto.get = function get(path, skipPostResponse) {\n    var _this4 = this;\n\n    return this.preflightAndHeaders(path).then(function (headers) {\n      return fetchWithNetworkError(_this4._getUrl(path), {\n        method: 'get',\n        headers: headers,\n        credentials: 'same-origin'\n      });\n    }).then(this._getPostResponseFunc(skipPostResponse)).then(function (res) {\n      return _this4._json(res);\n    }).catch(function (err) {\n      err = err.isAuthError ? err : new Error(\"Could not get \" + _this4._getUrl(path) + \". \" + err);\n      return Promise.reject(err);\n    });\n  };\n\n  _proto.post = function post(path, data, skipPostResponse) {\n    var _this5 = this;\n\n    return this.preflightAndHeaders(path).then(function (headers) {\n      return fetchWithNetworkError(_this5._getUrl(path), {\n        method: 'post',\n        headers: headers,\n        credentials: 'same-origin',\n        body: JSON.stringify(data)\n      });\n    }).then(this._getPostResponseFunc(skipPostResponse)).then(function (res) {\n      return _this5._json(res);\n    }).catch(function (err) {\n      err = err.isAuthError ? err : new Error(\"Could not post \" + _this5._getUrl(path) + \". \" + err);\n      return Promise.reject(err);\n    });\n  };\n\n  _proto.delete = function _delete(path, data, skipPostResponse) {\n    var _this6 = this;\n\n    return this.preflightAndHeaders(path).then(function (headers) {\n      return fetchWithNetworkError(_this6.hostname + \"/\" + path, {\n        method: 'delete',\n        headers: headers,\n        credentials: 'same-origin',\n        body: data ? JSON.stringify(data) : null\n      });\n    }).then(this._getPostResponseFunc(skipPostResponse)).then(function (res) {\n      return _this6._json(res);\n    }).catch(function (err) {\n      err = err.isAuthError ? err : new Error(\"Could not delete \" + _this6._getUrl(path) + \". \" + err);\n      return Promise.reject(err);\n    });\n  };\n\n  _createClass(RequestClient, [{\n    key: \"hostname\",\n    get: function get() {\n      var _this$uppy$getState = this.uppy.getState(),\n          companion = _this$uppy$getState.companion;\n\n      var host = this.opts.companionUrl;\n      return stripSlash(companion && companion[host] ? companion[host] : host);\n    }\n  }, {\n    key: \"defaultHeaders\",\n    get: function get() {\n      return {\n        Accept: 'application/json',\n        'Content-Type': 'application/json',\n        'Uppy-Versions': \"@uppy/companion-client=\" + RequestClient.VERSION\n      };\n    }\n  }]);\n\n  return RequestClient;\n}(), _class.VERSION = \"1.5.3\", _temp);"]},"metadata":{},"sourceType":"script"}