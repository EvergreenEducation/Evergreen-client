{"ast":null,"code":"import _objectSpread from \"/home/devnineteen/Desktop/Projects/Evergreen-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _asyncToGenerator from \"/home/devnineteen/Desktop/Projects/Evergreen-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _findIndex from \"lodash/findIndex\";\nimport _last from \"lodash/last\";\nvar _jsxFileName = \"/home/devnineteen/Desktop/Projects/Evergreen-client/src/components/promotion/PromoteCard/PromoteCard.js\";\n\n(function () {\n  var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;\n  enterModule && enterModule(module);\n})();\n\nvar __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {\n  return a;\n};\n\nimport React from 'react';\nimport { Button, Popconfirm } from 'antd';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faImage } from '@fortawesome/free-regular-svg-icons';\nimport axiosInstance from 'services/AxiosInstance';\nimport useGlobalStore from 'store/GlobalStore';\nimport './promote-card.scss';\n\nconst _default = function _default({\n  data = {},\n  session\n}) {\n  const _useGlobalStore = useGlobalStore(),\n        provider = _useGlobalStore.provider,\n        offer = _useGlobalStore.offer,\n        pathway = _useGlobalStore.pathway;\n\n  const adminId = session.id;\n\n  const update = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator(function* (id, endpoint, data, container) {\n      if (!id || !endpoint || !data) {\n        return;\n      }\n\n      const response = yield axiosInstance.put(`/${endpoint}/${id}?scope=with_files`, data);\n      container.updateOne(response.data);\n      return response;\n    });\n\n    return function update(_x, _x2, _x3, _x4) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  const removeAdminId = (nameOfUserIdArr, userIdsArr, incomingPromoData) => {\n    const foundAdminIndex = _findIndex(userIdsArr, function (item) {\n      return item === adminId;\n    });\n\n    const newMainPromotedByUserIds = userIdsArr;\n    newMainPromotedByUserIds.splice(foundAdminIndex, 1);\n    return _objectSpread(_objectSpread({}, incomingPromoData), {}, {\n      [nameOfUserIdArr]: newMainPromotedByUserIds\n    });\n  };\n\n  const includeAdminId = (promoData, nameOfUserIdArr, userIdArr) => {\n    const newObj = _objectSpread(_objectSpread({}, promoData), {}, {\n      [nameOfUserIdArr]: [...userIdArr, adminId]\n    });\n\n    return newObj;\n  };\n\n  function togglePromo(data, promoType) {\n    const is_local_promo = data.is_local_promo,\n          entity_type = data.entity_type,\n          is_main_promo = data.is_main_promo,\n          local_promoted_by_user_ids = data.local_promoted_by_user_ids,\n          main_promoted_by_user_ids = data.main_promoted_by_user_ids;\n    let localPromoData = {\n      is_local_promo: !is_local_promo\n    };\n    let mainPromoData = {\n      is_main_promo: !is_main_promo\n    };\n    const resetPromoData = {\n      is_main_promo: false,\n      is_local_promo: false,\n      local_promoted_by_user_ids: [],\n      main_promoted_by_user_ids: []\n    };\n\n    if (entity_type === 'offer') {\n      if (promoType === 'local') {\n        if (localPromoData.is_local_promo) {\n          localPromoData = includeAdminId(localPromoData, 'local_promoted_by_user_ids', local_promoted_by_user_ids);\n        } else {\n          localPromoData = removeAdminId('local_promoted_by_user_ids', local_promoted_by_user_ids, localPromoData);\n        }\n\n        return update(data.id, 'offers', localPromoData, offer);\n      }\n\n      if (promoType === 'main') {\n        if (mainPromoData.is_main_promo) {\n          mainPromoData = includeAdminId(mainPromoData, 'main_promoted_by_user_ids', main_promoted_by_user_ids);\n        } else {\n          mainPromoData = removeAdminId('main_promoted_by_user_ids', main_promoted_by_user_ids, mainPromoData);\n        }\n\n        return update(data.id, 'offers', mainPromoData, offer);\n      }\n\n      return update(data.id, 'offers', resetPromoData, offer);\n    }\n\n    if (entity_type === 'provider') {\n      if (promoType === 'local') {\n        if (localPromoData.is_local_promo) {\n          localPromoData = includeAdminId(localPromoData, 'local_promoted_by_user_ids', local_promoted_by_user_ids);\n        } else {\n          localPromoData = removeAdminId('local_promoted_by_user_ids', local_promoted_by_user_ids, localPromoData);\n        }\n\n        return update(data.id, 'providers', localPromoData, provider);\n      }\n\n      if (promoType === 'main') {\n        if (mainPromoData.is_main_promo) {\n          mainPromoData = includeAdminId(mainPromoData, 'main_promoted_by_user_ids', main_promoted_by_user_ids);\n        } else {\n          mainPromoData = removeAdminId('main_promoted_by_user_ids', main_promoted_by_user_ids, mainPromoData);\n        }\n\n        return update(data.id, 'providers', mainPromoData, provider);\n      }\n\n      return update(data.id, 'providers', resetPromoData, provider);\n    }\n\n    if (entity_type === 'pathway') {\n      if (promoType === 'local') {\n        if (localPromoData.is_local_promo) {\n          localPromoData = includeAdminId(localPromoData, 'local_promoted_by_user_ids', local_promoted_by_user_ids);\n        } else {\n          localPromoData = removeAdminId('local_promoted_by_user_ids', local_promoted_by_user_ids, localPromoData);\n        }\n\n        return update(data.id, 'pathways', localPromoData, pathway);\n      }\n\n      if (promoType === 'main') {\n        if (mainPromoData.is_main_promo) {\n          mainPromoData = includeAdminId(mainPromoData, 'main_promoted_by_user_ids', main_promoted_by_user_ids);\n        } else {\n          mainPromoData = removeAdminId('main_promoted_by_user_ids', main_promoted_by_user_ids, mainPromoData);\n        }\n\n        return update(data.id, 'pathways', mainPromoData, pathway);\n      }\n\n      return update(data.id, 'pathways', resetPromoData, pathway);\n    }\n\n    return;\n  }\n\n  function confirm(e) {\n    togglePromo(data);\n  }\n\n  let themeBorder = 'promote-card--offerBorder';\n  let themeBackground = 'promote-card--offerBg';\n\n  if (data && data.entity_type === 'provider') {\n    themeBorder = 'promote-card--providerBorder';\n    themeBackground = 'promote-card--providerBg';\n  }\n\n  if (data && data.entity_type === 'pathway') {\n    themeBorder = 'promote-card--pathwayBorder';\n    themeBackground = 'promote-card--pathwayBg';\n  }\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: `promote-card h-auto w-48 mr-3 mb-3 rounded border border-solid ${themeBorder} shadow`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"header\", {\n    className: `py-1 px-2 text-center capitalize ${themeBackground}`,\n    style: {\n      borderTopRightRadius: '0.20rem',\n      borderTopLeftRadius: '0.20rem'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 7\n    }\n  }, data && data.entity_type ? data.entity_type : ''), /*#__PURE__*/React.createElement(\"figure\", {\n    className: \"block bg-gray-200\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 7\n    }\n  }, data && data.Files && data.Files.length && /*#__PURE__*/React.createElement(\"img\", {\n    className: \"object-cover mx-auto\",\n    style: {\n      height: 112\n    },\n    src: data.Files && data.Files.length ? _last(data.Files).file_link : null,\n    alt: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 11\n    }\n  }) || /*#__PURE__*/React.createElement(\"div\", {\n    className: \"mx-auto p-6\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(FontAwesomeIcon, {\n    className: \"text-6xl text-gray-400 mx-auto block\",\n    icon: faImage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 13\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"flex flex-col pb-2 px-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"text-base break-all\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 9\n    }\n  }, data && data.name ? data.name : '---'), /*#__PURE__*/React.createElement(\"footer\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    size: \"small\",\n    className: `mr-1 rounded text-white border-none promote-card__toggleBtn promote-card__toggleBtn--main ${data && data.is_main_promo ? 'promote-card--toggledMain shadow-inner' : 'promote-card--notToggled shadow-md'}`,\n    onClick: () => {\n      if (data) {\n        togglePromo(data, 'main');\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 11\n    }\n  }, \"main\"), /*#__PURE__*/React.createElement(Button, {\n    size: \"small\",\n    className: `rounded text-white border-none promote-card__toggleBtn promote-card__toggleBtn--local ${data && data.is_local_promo ? 'promote-card--toggledLocal shadow-inner' : 'promote-card--notToggled shadow-md'}`,\n    onClick: () => {\n      if (data) {\n        togglePromo(data, 'local');\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 244,\n      columnNumber: 11\n    }\n  }, \"local\"), /*#__PURE__*/React.createElement(Popconfirm, {\n    title: \"Are you sure?\",\n    onConfirm: confirm,\n    okText: \"Yes\",\n    cancelText: \"No\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 259,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    type: \"link\",\n    size: \"small\",\n    danger: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 265,\n      columnNumber: 13\n    }\n  }, \"reset\")))));\n};\n\n__signature__(_default, \"useGlobalStore{{ provider, offer, pathway }}\", () => [useGlobalStore]);\n\nexport default _default;\n;\n\n(function () {\n  var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;\n\n  if (!reactHotLoader) {\n    return;\n  }\n\n  reactHotLoader.register(_default, \"default\", \"/home/devnineteen/Desktop/Projects/Evergreen-client/src/components/promotion/PromoteCard/PromoteCard.js\");\n})();\n\n;\n\n(function () {\n  var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;\n  leaveModule && leaveModule(module);\n})();","map":{"version":3,"sources":["/home/devnineteen/Desktop/Projects/Evergreen-client/src/components/promotion/PromoteCard/PromoteCard.js"],"names":["React","Button","Popconfirm","FontAwesomeIcon","faImage","axiosInstance","useGlobalStore","data","session","provider","offer","pathway","adminId","id","update","endpoint","container","response","put","updateOne","removeAdminId","nameOfUserIdArr","userIdsArr","incomingPromoData","foundAdminIndex","item","newMainPromotedByUserIds","splice","includeAdminId","promoData","userIdArr","newObj","togglePromo","promoType","is_local_promo","entity_type","is_main_promo","local_promoted_by_user_ids","main_promoted_by_user_ids","localPromoData","mainPromoData","resetPromoData","confirm","e","themeBorder","themeBackground","borderTopRightRadius","borderTopLeftRadius","Files","length","height","file_link","name"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { Button, Popconfirm } from 'antd';\r\nimport { last, findIndex } from 'lodash';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { faImage } from '@fortawesome/free-regular-svg-icons';\r\nimport axiosInstance from 'services/AxiosInstance';\r\nimport useGlobalStore from 'store/GlobalStore';\r\nimport './promote-card.scss';\r\n\r\nexport default function ({ data = {}, session }) {\r\n  const { provider, offer, pathway } = useGlobalStore();\r\n  const adminId = session.id;\r\n\r\n  const update = async (id, endpoint, data, container) => {\r\n    if (!id || !endpoint || !data) {\r\n      return;\r\n    }\r\n    const response = await axiosInstance.put(\r\n      `/${endpoint}/${id}?scope=with_files`,\r\n      data\r\n    );\r\n    container.updateOne(response.data);\r\n    return response;\r\n  };\r\n\r\n  const removeAdminId = (nameOfUserIdArr, userIdsArr, incomingPromoData) => {\r\n    const foundAdminIndex = findIndex(userIdsArr, function (item) {\r\n      return item === adminId;\r\n    });\r\n    const newMainPromotedByUserIds = userIdsArr;\r\n    newMainPromotedByUserIds.splice(foundAdminIndex, 1);\r\n    return {\r\n      ...incomingPromoData,\r\n      [nameOfUserIdArr]: newMainPromotedByUserIds,\r\n    };\r\n  };\r\n\r\n  const includeAdminId = (promoData, nameOfUserIdArr, userIdArr) => {\r\n    const newObj = {\r\n      ...promoData,\r\n      [nameOfUserIdArr]: [...userIdArr, adminId],\r\n    };\r\n    return newObj;\r\n  };\r\n\r\n  function togglePromo(data, promoType) {\r\n    const {\r\n      is_local_promo,\r\n      entity_type,\r\n      is_main_promo,\r\n      local_promoted_by_user_ids,\r\n      main_promoted_by_user_ids,\r\n    } = data;\r\n    let localPromoData = { is_local_promo: !is_local_promo };\r\n    let mainPromoData = { is_main_promo: !is_main_promo };\r\n    const resetPromoData = {\r\n      is_main_promo: false,\r\n      is_local_promo: false,\r\n      local_promoted_by_user_ids: [],\r\n      main_promoted_by_user_ids: [],\r\n    };\r\n\r\n    if (entity_type === 'offer') {\r\n      if (promoType === 'local') {\r\n        if (localPromoData.is_local_promo) {\r\n          localPromoData = includeAdminId(\r\n            localPromoData,\r\n            'local_promoted_by_user_ids',\r\n            local_promoted_by_user_ids\r\n          );\r\n        } else {\r\n          localPromoData = removeAdminId(\r\n            'local_promoted_by_user_ids',\r\n            local_promoted_by_user_ids,\r\n            localPromoData\r\n          );\r\n        }\r\n\r\n        return update(data.id, 'offers', localPromoData, offer);\r\n      }\r\n      if (promoType === 'main') {\r\n        if (mainPromoData.is_main_promo) {\r\n          mainPromoData = includeAdminId(\r\n            mainPromoData,\r\n            'main_promoted_by_user_ids',\r\n            main_promoted_by_user_ids\r\n          );\r\n        } else {\r\n          mainPromoData = removeAdminId(\r\n            'main_promoted_by_user_ids',\r\n            main_promoted_by_user_ids,\r\n            mainPromoData\r\n          );\r\n        }\r\n\r\n        return update(data.id, 'offers', mainPromoData, offer);\r\n      }\r\n      return update(data.id, 'offers', resetPromoData, offer);\r\n    }\r\n    if (entity_type === 'provider') {\r\n      if (promoType === 'local') {\r\n        if (localPromoData.is_local_promo) {\r\n          localPromoData = includeAdminId(\r\n            localPromoData,\r\n            'local_promoted_by_user_ids',\r\n            local_promoted_by_user_ids\r\n          );\r\n        } else {\r\n          localPromoData = removeAdminId(\r\n            'local_promoted_by_user_ids',\r\n            local_promoted_by_user_ids,\r\n            localPromoData\r\n          );\r\n        }\r\n        return update(data.id, 'providers', localPromoData, provider);\r\n      }\r\n      if (promoType === 'main') {\r\n        if (mainPromoData.is_main_promo) {\r\n          mainPromoData = includeAdminId(\r\n            mainPromoData,\r\n            'main_promoted_by_user_ids',\r\n            main_promoted_by_user_ids\r\n          );\r\n        } else {\r\n          mainPromoData = removeAdminId(\r\n            'main_promoted_by_user_ids',\r\n            main_promoted_by_user_ids,\r\n            mainPromoData\r\n          );\r\n        }\r\n        return update(data.id, 'providers', mainPromoData, provider);\r\n      }\r\n      return update(data.id, 'providers', resetPromoData, provider);\r\n    }\r\n    if (entity_type === 'pathway') {\r\n      if (promoType === 'local') {\r\n        if (localPromoData.is_local_promo) {\r\n          localPromoData = includeAdminId(\r\n            localPromoData,\r\n            'local_promoted_by_user_ids',\r\n            local_promoted_by_user_ids\r\n          );\r\n        } else {\r\n          localPromoData = removeAdminId(\r\n            'local_promoted_by_user_ids',\r\n            local_promoted_by_user_ids,\r\n            localPromoData\r\n          );\r\n        }\r\n        return update(data.id, 'pathways', localPromoData, pathway);\r\n      }\r\n      if (promoType === 'main') {\r\n        if (mainPromoData.is_main_promo) {\r\n          mainPromoData = includeAdminId(\r\n            mainPromoData,\r\n            'main_promoted_by_user_ids',\r\n            main_promoted_by_user_ids\r\n          );\r\n        } else {\r\n          mainPromoData = removeAdminId(\r\n            'main_promoted_by_user_ids',\r\n            main_promoted_by_user_ids,\r\n            mainPromoData\r\n          );\r\n        }\r\n        return update(data.id, 'pathways', mainPromoData, pathway);\r\n      }\r\n      return update(data.id, 'pathways', resetPromoData, pathway);\r\n    }\r\n    return;\r\n  }\r\n\r\n  function confirm(e) {\r\n    togglePromo(data);\r\n  }\r\n\r\n  let themeBorder = 'promote-card--offerBorder';\r\n  let themeBackground = 'promote-card--offerBg';\r\n\r\n  if (data && data.entity_type === 'provider') {\r\n    themeBorder = 'promote-card--providerBorder';\r\n    themeBackground = 'promote-card--providerBg';\r\n  }\r\n\r\n  if (data && data.entity_type === 'pathway') {\r\n    themeBorder = 'promote-card--pathwayBorder';\r\n    themeBackground = 'promote-card--pathwayBg';\r\n  }\r\n\r\n  return (\r\n    <div\r\n      className={`promote-card h-auto w-48 mr-3 mb-3 rounded border border-solid ${themeBorder} shadow`}\r\n    >\r\n      <header\r\n        className={`py-1 px-2 text-center capitalize ${themeBackground}`}\r\n        style={{\r\n          borderTopRightRadius: '0.20rem',\r\n          borderTopLeftRadius: '0.20rem',\r\n        }}\r\n      >\r\n        {data && data.entity_type ? data.entity_type : ''}\r\n      </header>\r\n      <figure className=\"block bg-gray-200\">\r\n        {(data && data.Files && data.Files.length && (\r\n          <img\r\n            className=\"object-cover mx-auto\"\r\n            style={{ height: 112 }}\r\n            src={\r\n              data.Files && data.Files.length\r\n                ? last(data.Files).file_link\r\n                : null\r\n            }\r\n            alt=\"\"\r\n          />\r\n        )) || (\r\n          <div className=\"mx-auto p-6\">\r\n            <FontAwesomeIcon\r\n              className=\"text-6xl text-gray-400 mx-auto block\"\r\n              icon={faImage}\r\n            />\r\n          </div>\r\n        )}\r\n      </figure>\r\n      <div className=\"flex flex-col pb-2 px-2\">\r\n        <span className=\"text-base break-all\">\r\n          {data && data.name ? data.name : '---'}\r\n        </span>\r\n        <footer>\r\n          <Button\r\n            size=\"small\"\r\n            className={`mr-1 rounded text-white border-none promote-card__toggleBtn promote-card__toggleBtn--main ${\r\n              data && data.is_main_promo\r\n                ? 'promote-card--toggledMain shadow-inner'\r\n                : 'promote-card--notToggled shadow-md'\r\n            }`}\r\n            onClick={() => {\r\n              if (data) {\r\n                togglePromo(data, 'main');\r\n              }\r\n            }}\r\n          >\r\n            main\r\n          </Button>\r\n          <Button\r\n            size=\"small\"\r\n            className={`rounded text-white border-none promote-card__toggleBtn promote-card__toggleBtn--local ${\r\n              data && data.is_local_promo\r\n                ? 'promote-card--toggledLocal shadow-inner'\r\n                : 'promote-card--notToggled shadow-md'\r\n            }`}\r\n            onClick={() => {\r\n              if (data) {\r\n                togglePromo(data, 'local');\r\n              }\r\n            }}\r\n          >\r\n            local\r\n          </Button>\r\n          <Popconfirm\r\n            title=\"Are you sure?\"\r\n            onConfirm={confirm}\r\n            okText=\"Yes\"\r\n            cancelText=\"No\"\r\n          >\r\n            <Button type=\"link\" size=\"small\" danger>\r\n              reset\r\n            </Button>\r\n          </Popconfirm>\r\n        </footer>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}